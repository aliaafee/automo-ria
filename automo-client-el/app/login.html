<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; connect-src *">
        <link rel="stylesheet" href="style.css" type="text/css">
        <title>AutoMO - Login</title>
        </head>
    <body>
    <section class="main">
        <h1 class="pagetitle">AutoMO - Login</h1>
        <form class="login-form">
            <div class="form-controls">
                <input class="indexurl" type="text" placeholder="Server" value="http://127.0.0.1:5000/api/">
                <input class="username" type="text" placeholder="Username">
                <input class="password" type="password" placeholder="Password">
            </div>
            <div class="form-actions">
                <button class="login" type="submit">Login</button>
                <button class="quit">Quit</button>
            </div>
            <div class="form-controls">
                <span class="status"></span>
            </div>
        </form>  
    </section>

    <script>
        const ipc = require('electron').ipcRenderer;

        const txtIndexUrl = document.querySelector(".indexurl");
        const txtUsername = document.querySelector(".username");
        const txtPassword = document.querySelector(".password");
        const btnLogin = document.querySelector(".login");
        const btnQuit = document.querySelector(".quit");
        const statusBar = document.querySelector(".status");
        const loginForm = document.querySelector(".login-form");

        loginForm.addEventListener('submit', (event) => {
            event.preventDefault();
            ipc.send('login-window-login', {
                index_url: txtIndexUrl.value,
                username: txtUsername.value,
                password: txtPassword.value
            });
            statusBar.innerHTML = "Logging in...";
        });

        btnQuit.addEventListener('click', () => {
            ipc.send('login-window-quit', 'ping')
        });

        ipc.on('login-failed', (event, arg) => {
            statusBar.innerHTML = `${arg}`;
            txtUsername.focus();
        })

        ipc.on('login-success', (event, arg) => {
            statusBar.innerHTML = "";
            txtUsername.value = "";
            txtPassword.value = "";
            txtUsername.focus();
        })

        txtUsername.focus();
    </script>

  </body>

</html>
